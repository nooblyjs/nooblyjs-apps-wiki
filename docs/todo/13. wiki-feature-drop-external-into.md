# Drop Files Into Browser

## Requirement
I would like to create the feature where I can drag files into the browser window (into the left nav or content folder) and the files automatically upload to the document repository.

## Implementation Todo List

### Phase 1: Drag & Drop Event Handlers
- [ ] Create drag and drop handler module `src/views/js/modules/dragDropManager.js`
  - [ ] Implement `dragover` event listener
    - [ ] Prevent default behavior
    - [ ] Add visual feedback (highlight drop zone)
    - [ ] Set transfer effect to "copy"
  - [ ] Implement `dragleave` event listener
    - [ ] Remove visual feedback when leaving drop zone
  - [ ] Implement `drop` event listener
    - [ ] Prevent default behavior
    - [ ] Extract files from `event.dataTransfer.files`
    - [ ] Call upload handler with files and target folder
  - [ ] Implement `dragend` event listener
    - [ ] Clean up visual feedback

### Phase 2: Drop Zone Definition
- [ ] Define primary drop zones
  - [ ] Main content area (`#documentView`)
  - [ ] Left navigation panel (`#navigationPanel` or similar)
  - [ ] File tree folders (for folder-specific drops)
- [ ] Add visual drop zones
  - [ ] Create overlay div that shows during drag: `#dropZone`
  - [ ] Style with dashed border, background highlight
  - [ ] Show drop target folder indicator
- [ ] Implement smart drop targeting
  - [ ] Detect which folder user is dropping into
  - [ ] Highlight target folder during drag
  - [ ] Use current active folder if dropping in content area
  - [ ] Use clicked folder if dropping on navigation item

### Phase 3: File Validation
- [ ] Implement file type validation
  - [ ] Check MIME types against allowed types
  - [ ] Check file extensions against allowlist
  - [ ] Allow: images, documents, code, archives, etc.
  - [ ] Block: executables, system files, etc.
- [ ] Implement file size validation
  - [ ] Set max file size (configurable, e.g., 100MB)
  - [ ] Set max total upload size (e.g., 500MB)
  - [ ] Show friendly error messages for size violations
- [ ] Validate file count
  - [ ] Set max files per drop (e.g., 10)
  - [ ] Warn user if exceeding limit

### Phase 4: Upload Handler
- [ ] Create upload endpoint (if not exists)
  - [ ] `POST /applications/wiki/api/documents/upload`
  - [ ] Accept FormData with files and target folder/space
  - [ ] Implement multipart form handling with multer
  - [ ] Return upload status for each file
- [ ] Implement file upload logic
  - [ ] Save files to appropriate space directory
  - [ ] Generate unique filenames if duplicates
  - [ ] Preserve file metadata (dates, permissions)
  - [ ] Create document metadata entries
  - [ ] Index files for search
- [ ] Handle multiple simultaneous uploads
  - [ ] Track upload progress per file
  - [ ] Allow cancel functionality
  - [ ] Parallel upload (with concurrency limit)

### Phase 5: Upload Progress UI
- [ ] Create upload progress display
  - [ ] Modal or inline upload progress panel
  - [ ] Show list of files being uploaded
  - [ ] Progress bar per file
  - [ ] Overall progress percentage
  - [ ] File size and upload speed
  - [ ] ETA calculation
- [ ] Add upload status indicators
  - [ ] Uploading (spinner/progress)
  - [ ] Success (checkmark)
  - [ ] Error (X icon with error message)
  - [ ] Retry button for failed uploads
- [ ] Implement cancel functionality
  - [ ] Cancel individual file uploads
  - [ ] Cancel all uploads button
  - [ ] Confirmation dialog for cancel

### Phase 6: Error Handling
- [ ] Implement error scenarios
  - [ ] Network errors (retry logic)
  - [ ] File too large (user-friendly message)
  - [ ] Unsupported file type (suggest supported types)
  - [ ] Disk quota exceeded (show available space)
  - [ ] Permission denied (show access error)
  - [ ] Duplicate filename (auto-rename or prompt)
- [ ] Add recovery mechanisms
  - [ ] Retry button for failed uploads
  - [ ] Auto-retry with exponential backoff
  - [ ] Resume capability for large files
  - [ ] Log errors for debugging

### Phase 7: File Organization
- [ ] Implement folder detection
  - [ ] If dragging into folder in navigation, upload to that folder
  - [ ] If dragging into content area, use current active folder
  - [ ] If no folder selected, use space root or "Inbox" folder
- [ ] Create automatic organization
  - [ ] Option to organize by file type (Pictures, Documents, etc.)
  - [ ] Option to organize by date (Year/Month folders)
  - [ ] Option to organize by custom rules
- [ ] Handle duplicate files
  - [ ] Auto-rename with number suffix (file-1.txt, file-2.txt)
  - [ ] Or prompt user to overwrite/skip/rename
  - [ ] Show conflict resolution UI

### Phase 8: UI Integration
- [ ] Update navigation controller
  - [ ] Enable drag drop on folder items
  - [ ] Show drop indicator when dragging over folder
  - [ ] Expand folders on drag-over-hold
- [ ] Update document controller
  - [ ] Enable drag drop in content area
  - [ ] Show drop zone overlay
- [ ] Update file tree
  - [ ] Highlight drop target folder
  - [ ] Prevent dropping on read-only folders
  - [ ] Show appropriate cursor feedback

### Phase 9: Feedback & Notifications
- [ ] Implement toast notifications
  - [ ] "Upload started: X files"
  - [ ] "Upload complete: X files added"
  - [ ] "Upload failed: X files, Y errors"
- [ ] Add success feedback
  - [ ] Navigate to uploaded files after upload
  - [ ] Highlight newly uploaded files
  - [ ] Show quick preview/preview option
- [ ] Add failure feedback
  - [ ] Detailed error messages
  - [ ] Link to support/documentation for common errors

### Phase 10: Browser Integration
- [ ] Prevent default browser drag behavior
  - [ ] Override document-level drag events
  - [ ] Block navigation to dropped file
  - [ ] Block opening file in new tab
- [ ] Implement clipboard image paste (bonus)
  - [ ] Support pasting images from clipboard
  - [ ] Save to "pasted" folder
  - [ ] Same upload flow as drag-drop

### Phase 11: Performance Optimization
- [ ] Implement chunked uploads for large files
  - [ ] Split large files into chunks
  - [ ] Upload chunks in parallel
  - [ ] Reassemble on server
  - [ ] Resume from interrupted chunks
- [ ] Optimize for multiple file uploads
  - [ ] Queue management for concurrent uploads
  - [ ] Limit concurrent connections
  - [ ] Batch related uploads
- [ ] Optimize file indexing
  - [ ] Batch index updates
  - [ ] Defer search index updates if many files
  - [ ] Background indexing to not block UI

### Phase 12: Security Considerations
- [ ] Implement file upload security
  - [ ] Validate file types on server (not just client)
  - [ ] Scan uploaded files for malware (if applicable)
  - [ ] Isolate uploaded files from execution
  - [ ] Check disk space before upload
  - [ ] Prevent path traversal in filenames
- [ ] Rate limiting
  - [ ] Limit uploads per user
  - [ ] Limit upload bandwidth
  - [ ] Prevent abuse

### Phase 13: Testing
- [ ] Unit tests for dragDropManager
  - [ ] Test file validation logic
  - [ ] Test upload request generation
- [ ] Integration tests
  - [ ] Test drag drop events
  - [ ] Test file upload flow
  - [ ] Test error scenarios
- [ ] Manual testing
  - [ ] Drag single file
  - [ ] Drag multiple files
  - [ ] Drag into different folders
  - [ ] Test with large files
  - [ ] Test on different browsers (Chrome, Firefox, Safari, Edge)
  - [ ] Test with various file types
  - [ ] Test error scenarios (network, file size, etc.)

### Phase 14: Documentation
- [ ] Update CLAUDE.md with drag-drop documentation
  - [ ] Explain feature and usage
  - [ ] Document supported file types
  - [ ] Document file size limits
- [ ] Create user guide
  - [ ] Screenshots showing drag-drop in action
  - [ ] Keyboard alternative (if any)
  - [ ] Troubleshooting common issues
- [ ] Document API for developers
  - [ ] Upload endpoint specification
  - [ ] Error response formats
  - [ ] Progress event structure
