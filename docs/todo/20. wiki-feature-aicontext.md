# AI Context

## Requirement: Create context Data
To enhance the AI context structures I would like a scheduled job that walks through the files and folders and adds data to the aicontext folder.

## Detailed
 - Please create a scheduled job that runs every 5 mins.
 - The job should check the ai is configired and ready to be used.
 - The job should look through the .aicontext hidden folder and check if the folder-context.md file exists, if it doesnt then the job should pass look at the folder and ask the ai to create context based on the folder name and its contents what the purpose is and add it to the folder-context.md.
 - The job should look through the files in the folder and check if there is a {filename}-context.md file in the .aicontext folder. If there is not a file and the file is text based (md, txt, code file), the folder should pass the content of the file to the ai as have it explain the context of the file and save it to {filename}-context.md.

## Implementation Todo List

### Phase 1: Scheduler Infrastructure
- [ ] Create `src/activities/aiContextScheduler.js` with scheduler logic
  - [ ] Initialize scheduler with configurable interval (default 5 mins)
  - [ ] Add startup delay (2 seconds) before first run
  - [ ] Implement error handling and retry logic
  - [ ] Add logging for scheduler lifecycle
- [ ] Update `index.js` to initialize scheduler on startup
  - [ ] Call scheduler initialization after AI service ready check
  - [ ] Handle scheduler initialization errors gracefully

### Phase 2: AI Readiness Check
- [ ] Create utility function `isAIReady()` in scheduler
  - [ ] Check if AI service is configured
  - [ ] Validate API credentials are set
  - [ ] Test AI service connectivity
  - [ ] Return boolean status
- [ ] Implement configuration validation
  - [ ] Check `aiSettings_{userId}.json` exists
  - [ ] Verify required AI provider settings
  - [ ] Handle missing/invalid configuration gracefully

### Phase 3: Folder Context Generation
- [ ] Create `generateFolderContext()` function
  - [ ] Recursively walk directory structure
  - [ ] Skip hidden folders (starting with `.`) except `.aicontext`
  - [ ] For each folder:
    - [ ] Check if `.aicontext/folder-context.md` exists
    - [ ] If missing:
      - [ ] Analyze folder contents (list files, count, types)
      - [ ] Extract folder metadata (name, structure)
      - [ ] Create AI prompt with folder analysis
      - [ ] Send to AI service with request for context
      - [ ] Create `.aicontext` directory if needed
      - [ ] Save response to `folder-context.md`
      - [ ] Log success/failure
    - [ ] Skip if context already exists (non-destructive)

### Phase 4: File Context Generation
- [ ] Create `generateFileContext()` function
  - [ ] Define supported text file types: `.md`, `.txt`, `.js`, `.ts`, `.py`, `.java`, `.cpp`, `.c`, `.go`, `.rb`, `.php`, `.json`, `.yaml`, `.yml`, `.xml`, `.csv`, `.sql`, `.html`, `.css`, `.sh`, `.bash`, `.log`
  - [ ] For each file in folder:
    - [ ] Check if file is text-based (by extension)
    - [ ] Check if `{filename}-context.md` exists in `.aicontext`
    - [ ] If missing:
      - [ ] Read file content (limit to first 5000 chars for efficiency)
      - [ ] Create AI prompt with file analysis request
      - [ ] Send to AI service
      - [ ] Create `.aicontext` directory if needed
      - [ ] Save response to `{filename}-context.md`
      - [ ] Log success/failure
    - [ ] Skip if context already exists
- [ ] Handle file read errors gracefully
  - [ ] Skip binary/corrupted files
  - [ ] Log errors but continue processing

### Phase 5: Scheduler Integration
- [ ] Create main processing function `processAllSpaces()`
  - [ ] Get list of all spaces from dataManager
  - [ ] For each space:
    - [ ] Get space path
    - [ ] Call `processSpace(spacePath)`
    - [ ] Handle errors per-space (don't stop on error)
  - [ ] Log summary statistics (folders processed, contexts created, errors)
  - [ ] Return processing status
- [ ] Implement scheduled execution
  - [ ] Start scheduler after 2-second delay on startup
  - [ ] Run every 5 minutes (configurable)
  - [ ] Prevent overlapping executions (check if already running)
  - [ ] Implement graceful shutdown on app termination

### Phase 6: API Endpoints
- [ ] Add manual trigger endpoint
  - [ ] `POST /applications/wiki/api/ai/generate-contexts`
  - [ ] Call `processAllSpaces()` in background
  - [ ] Return immediate response
  - [ ] Require authentication
- [ ] Add status check endpoint
  - [ ] `GET /applications/wiki/api/ai/context-status`
  - [ ] Return AI readiness status
  - [ ] Return processing status (running/idle)
  - [ ] Return last execution timestamp
  - [ ] No authentication required for status check

### Phase 7: Frontend Integration
- [ ] Update settings controller to add "Generate Contexts" button
  - [ ] Show button only if AI is configured
  - [ ] Trigger manual generation via API
  - [ ] Show loading spinner during generation
  - [ ] Display success/error messages
- [ ] Add status indicator
  - [ ] Display AI context generation status
  - [ ] Show last execution time
  - [ ] Show number of contexts created

### Phase 8: Logging & Monitoring
- [ ] Implement detailed logging
  - [ ] Log scheduler start/stop
  - [ ] Log each space processing
  - [ ] Log folder/file context creation
  - [ ] Log errors with context
  - [ ] Log summary statistics
- [ ] Add performance metrics
  - [ ] Track execution time
  - [ ] Track number of contexts created
  - [ ] Track errors/failures
- [ ] Create log rotation policy
  - [ ] Keep last 30 days of logs
  - [ ] Archive old logs

### Phase 9: Testing
- [ ] Unit tests for scheduler functions
  - [ ] Test `isAIReady()` with various configurations
  - [ ] Test folder traversal logic
  - [ ] Test context generation with mocked AI
- [ ] Integration tests
  - [ ] Test full scheduler run with real AI (if available)
  - [ ] Test error handling and recovery
  - [ ] Test API endpoints
- [ ] Manual testing
  - [ ] Test with test spaces and files
  - [ ] Verify context files created in correct locations
  - [ ] Verify scheduler runs on expected interval
  - [ ] Test manual trigger endpoint

### Phase 10: Documentation
- [ ] Update CLAUDE.md with feature documentation
  - [ ] Explain how to configure AI context generation
  - [ ] Document API endpoints
  - [ ] Document context file format
- [ ] Add inline code documentation
  - [ ] JSDoc comments for all functions
  - [ ] Explain algorithm and approach
- [ ] Create troubleshooting guide
  - [ ] How to debug generation failures
  - [ ] How to regenerate contexts
  - [ ] How to check scheduler status

