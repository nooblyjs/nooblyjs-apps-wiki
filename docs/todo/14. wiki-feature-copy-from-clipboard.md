# Copy and Paste Files Into Browser

## Requirement
I would like to create the feature that allows me to take screenshots and paste in the browser. The browser reads the clipboard and saves the files in a designated "pasted" folder that can be referenced in the markdown editor.

## Implementation Todo List

### Phase 1: Clipboard API Setup
- [ ] Create clipboard handler module `src/views/js/modules/clipboardManager.js`
  - [ ] Check browser clipboard API support (modern browsers)
  - [ ] Implement fallback for older browsers if needed
  - [ ] Add permissions handling for clipboard access
  - [ ] Implement `navigator.clipboard.read()` with error handling
- [ ] Setup clipboard event listeners
  - [ ] Listen for `paste` event on document
  - [ ] Listen for `Ctrl+V` / `Cmd+V` keydown event
  - [ ] Bind to specific elements (content area, input fields)

### Phase 2: Clipboard Content Detection
- [ ] Implement clipboard data extraction
  - [ ] Get clipboard items using ClipboardAPI
  - [ ] Check for image types (image/png, image/jpeg, image/gif, image/webp)
  - [ ] Check for file types (if available)
  - [ ] Check for text types (fallback)
  - [ ] Extract data from event.clipboardData for paste events
- [ ] Validate clipboard content
  - [ ] Verify MIME types
  - [ ] Check file sizes from clipboard
  - [ ] Handle non-image/file clipboard content
  - [ ] Provide user feedback for unsupported content

### Phase 3: Pasted Folder Management
- [ ] Create "pasted" folder structure
  - [ ] Ensure `./.application/wiki-files/pasted/` directory exists
  - [ ] Create within current space (not global)
  - [ ] Create API endpoint to get pasted folder path
  - [ ] Handle case where pasted folder doesn't exist
- [ ] Organize pasted files by date
  - [ ] Create subfolders: `pasted/YYYY/MM/DD/`
  - [ ] Or: `pasted/YYYY-MM-DD/`
  - [ ] Store today's pastes in easy-to-access location
- [ ] Allow custom folder selection
  - [ ] Let user choose where to save pasted files
  - [ ] Remember last folder used
  - [ ] Provide quick access to pasted folder

### Phase 4: Image Processing
- [ ] Implement image extraction from clipboard
  - [ ] Convert clipboard image to Blob
  - [ ] Determine image format (PNG, JPEG, GIF, WebP)
  - [ ] Set appropriate file extension
  - [ ] Generate unique filename
- [ ] Add image metadata
  - [ ] Timestamp when image was pasted
  - [ ] Original clipboard image type
  - [ ] Image dimensions (if available)
  - [ ] File size
- [ ] Implement image optimization (optional)
  - [ ] Resize if too large
  - [ ] Compress image quality
  - [ ] Convert format if needed
  - [ ] Generate thumbnail for preview

### Phase 5: File Save & Upload
- [ ] Create file save endpoint
  - [ ] `POST /applications/wiki/api/clipboard/save`
  - [ ] Accept Base64 or Blob data
  - [ ] Accept target folder/space
  - [ ] Accept filename
- [ ] Implement file storage
  - [ ] Save image to correct folder
  - [ ] Generate unique filename if duplicate exists
  - [ ] Create document metadata entry
  - [ ] Update search index
  - [ ] Emit file creation events
- [ ] Handle upload errors
  - [ ] Network errors with retry
  - [ ] Disk full errors
  - [ ] Permission errors
  - [ ] Invalid data errors

### Phase 6: UI Feedback & Notifications
- [ ] Implement paste success notifications
  - [ ] Toast message: "Image pasted successfully"
  - [ ] Show filename and size
  - [ ] Show quick action buttons (open, view folder)
- [ ] Add paste progress indicator
  - [ ] Show saving spinner
  - [ ] Display upload progress
  - [ ] Show completion status
- [ ] Implement error notifications
  - [ ] "Clipboard is empty"
  - [ ] "No image data found"
  - [ ] "Upload failed - retry"
  - [ ] "Unsupported content type"
- [ ] Add confirmation dialog (optional)
  - [ ] Show preview of pasted image
  - [ ] Allow user to confirm save
  - [ ] Allow choosing destination folder
  - [ ] Allow renaming file before save

### Phase 7: Markdown Editor Integration
- [ ] Auto-insert image reference in markdown
  - [ ] When in markdown editor, auto-insert markdown image syntax
  - [ ] Format: `![alt-text](relative/path/to/image.png)`
  - [ ] Calculate relative path from current document
  - [ ] Allow user to edit alt text
- [ ] Markdown editor paste handling
  - [ ] Override paste event in markdown textarea
  - [ ] Show preview of pasted image
  - [ ] Auto-insert markdown syntax
  - [ ] Focus cursor after insertion
- [ ] Visual previews
  - [ ] Show thumbnail in editor while editing
  - [ ] Show in preview pane
  - [ ] Live update as user types

### Phase 8: Multiple Paste Handling
- [ ] Handle rapid/multiple pastes
  - [ ] Queue multiple clipboard operations
  - [ ] Process sequentially to avoid conflicts
  - [ ] Show status for each pasted file
  - [ ] Allow retry for failed pastes
- [ ] Prevent duplicate files
  - [ ] Check for duplicate images (by content hash)
  - [ ] Warn if image already exists
  - [ ] Offer: reuse existing / save as new / skip
- [ ] Manage file naming
  - [ ] Auto-generate meaningful names: `screenshot-2025-10-31-14-32-15.png`
  - [ ] Allow user customization
  - [ ] Include metadata in filename (date, source, etc.)

### Phase 9: Clipboard Monitoring (Optional)
- [ ] Implement clipboard monitoring
  - [ ] Monitor clipboard for changes (with user permission)
  - [ ] Auto-save when image added to clipboard
  - [ ] Show notification for auto-saved items
  - [ ] Option to enable/disable auto-save
- [ ] Add clipboard history (Optional)
  - [ ] Remember recently pasted items
  - [ ] Quick access to recently pasted images
  - [ ] Option to restore/re-paste previous items

### Phase 10: File Organization & Naming
- [ ] Implement smart naming
  - [ ] Screenshot: `screenshot-YYYY-MM-DD-HH-MM-SS.png`
  - [ ] From clipboard: `clipboard-YYYY-MM-DD-HH-MM-SS.{ext}`
  - [ ] Allow custom naming patterns
  - [ ] Allow user-defined prefixes/suffixes
- [ ] Create date-based organization
  - [ ] Auto-create folders by date
  - [ ] Configurable structure (YYYY/MM, YYYY-MM-DD, etc.)
  - [ ] Easy browsing by date
- [ ] Add tagging system (optional)
  - [ ] Auto-tag pasted images with metadata
  - [ ] Allow user to add custom tags
  - [ ] Filter pasted files by tags

### Phase 11: Copy & Paste Text
- [ ] Extend to text content
  - [ ] Support pasting text as `.txt` file
  - [ ] Support pasting code with language detection
  - [ ] Support pasting rich text (HTML to Markdown conversion)
- [ ] Implement text preprocessing
  - [ ] Remove extra whitespace
  - [ ] Detect code language
  - [ ] Apply syntax highlighting
  - [ ] Format code nicely

### Phase 12: Settings & Preferences
- [ ] Add user preferences
  - [ ] Default pasted folder location
  - [ ] Auto-insert in markdown editor (yes/no)
  - [ ] Auto-organize by date (yes/no)
  - [ ] Naming convention template
  - [ ] Auto-save immediately or confirm first
- [ ] Add admin settings
  - [ ] Max file size for clipboard content
  - [ ] Allowed file types
  - [ ] Storage quota for pasted files
  - [ ] Retention policy (auto-delete old files)
- [ ] Create settings UI
  - [ ] Settings form in preferences panel
  - [ ] Validation of settings
  - [ ] Save to user preferences

### Phase 13: Accessibility
- [ ] Add keyboard shortcuts
  - [ ] `Ctrl+Shift+V` to paste from clipboard
  - [ ] `Ctrl+Shift+S` for screenshot paste
  - [ ] Context menu "Paste from Clipboard" option
- [ ] Add screen reader support
  - [ ] Announce paste success/failure
  - [ ] Read filename of pasted file
  - [ ] Describe clipboard content

### Phase 14: Testing
- [ ] Unit tests for clipboard operations
  - [ ] Test image detection
  - [ ] Test filename generation
  - [ ] Test path calculation
- [ ] Integration tests
  - [ ] Test paste event handling
  - [ ] Test file upload
  - [ ] Test markdown insertion
  - [ ] Test various image formats
- [ ] Manual testing
  - [ ] Test on different browsers (Chrome, Firefox, Safari, Edge)
  - [ ] Take actual screenshot and paste
  - [ ] Copy image from web and paste
  - [ ] Copy text and paste
  - [ ] Test with various image sizes
  - [ ] Test with read-only spaces
  - [ ] Test permission scenarios

### Phase 15: Security & Validation
- [ ] Implement security checks
  - [ ] Validate file types server-side
  - [ ] Scan image metadata
  - [ ] Check for malicious content
  - [ ] Validate image dimensions (prevent DDoS)
  - [ ] Check disk space before saving
- [ ] Prevent security issues
  - [ ] Prevent path traversal in filenames
  - [ ] Prevent overwriting system files
  - [ ] Prevent access to other users' files
  - [ ] Rate limiting on paste operations

### Phase 16: Documentation
- [ ] Update CLAUDE.md with clipboard feature
  - [ ] Explain feature and usage
  - [ ] Document supported content types
  - [ ] Document folder organization
- [ ] Create user guide
  - [ ] Instructions for taking screenshots
  - [ ] How to paste into wiki
  - [ ] Where files are saved
  - [ ] How to reference in markdown
  - [ ] Keyboard shortcuts
- [ ] Create troubleshooting guide
  - [ ] Browser permission issues
  - [ ] Clipboard not working scenarios
  - [ ] File not appearing issues
